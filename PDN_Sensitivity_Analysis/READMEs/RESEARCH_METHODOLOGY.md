# 研究方法詳細說明

## 一、研究問題

### 核心問題
**「Pixel Model 中的 R 值（Rx, Ry, Rz）對 PDN 分析結果的影響到底有多大？」**

### 問題背景

在 PDN（Power Delivery Network）設計中：
1. 我們需要知道每個位置的 IR drop（電壓降）
2. IR drop 的計算依賴於 PDN 的電阻模型
3. Pixel Model 用三個 R 值（Rx, Ry, Rz）來描述電阻
4. **問題**：如果這些 R 值不準確，IR drop 分析結果會差多少？

### 研究意義

- **設計優化**：如果 R 值很重要，我們需要投入更多資源做精確建模
- **驗證重要性**：證明「找到好的 R 值」確實很重要
- **風險評估**：了解 R 值誤差帶來的風險

---

## 二、研究方法：敏感度分析

### 什麼是敏感度分析？

敏感度分析是一種**系統性地改變輸入參數，觀察輸出結果變化**的方法。

**在我們的案例中**：
- **輸入參數**：R 值（Rx, Ry, Rz）
- **輸出結果**：PDN 網路的總電阻
- **目標**：量化「R 值變化對總電阻的影響」

### 為什麼用敏感度分析？

1. **直接有效**：直接觀察參數變化對結果的影響
2. **量化結果**：提供具體的數字（敏感度值）
3. **系統性**：覆蓋整個參數空間，不會遺漏
4. **易於理解**：結果容易解釋和應用

---

## 三、研究步驟

### 步驟 1：建立基準模型

**目標**：建立一個標準的 PDN 網路模型

**具體操作**：
1. 定義網格大小（例如 10×10）
2. 為每個網格點創建 PixelModel
3. 設定基準 R 值（例如 Rx=0.1Ω, Ry=0.1Ω, Rz=0.5Ω）
4. 建立網路結構（節點和分支）

**代碼對應**：
```cpp
// 建立網路
PDNNetwork network(10, 10, 1);

// 創建 pixel models
for (int r = 0; r < 10; r++) {
    for (int c = 0; c < 10; c++) {
        PixelModel model("...", 0.1, 0.1, 0.5, 1.0);
        network.setPixelModel(0, r, c, &model);
    }
}

// 建立網路結構
network.buildNetwork();
```

**為什麼這樣做？**
- 我們需要一個「基準點」來比較
- 基準模型代表「理想的、準確的 R 值」
- 之後我們會改變 R 值，觀察與基準的差異

### 步驟 2：執行參數掃描

**目標**：系統性地改變 R 值，觀察總電阻的變化

**具體操作**：

#### 2.1 單一 R 值掃描

**方法**：固定其他 R 值，只改變一個 R 值

**例子：掃描 Rx**
```
基準值：Rx = 0.1Ω, Ry = 0.1Ω, Rz = 0.5Ω

掃描範圍：Rx 從 0.5×0.1 = 0.05Ω 到 2.0×0.1 = 0.20Ω
步數：20 步
每步：Rx_new = 0.1 × (0.5 + i × 0.079)
```

**代碼邏輯**：
```cpp
for (int i = 0; i < 20; i++) {
    float ratio = 0.5 + i * (2.0 - 0.5) / 19;
    float rx = 0.1 * ratio;  // 只改變 Rx
    float ry = 0.1;          // Ry 不變
    float rz = 0.5;          // Rz 不變
    
    // 更新所有 pixel model
    applyResistancesToNetwork(rx, ry, rz);
    
    // 重建網路
    network.buildNetwork();
    
    // 計算總電阻
    double totalR = calculateTotalResistance();
    
    // 記錄結果
    results.push_back({rx, ry, rz, totalR});
}
```

**為什麼這樣做？**
- **隔離變數**：只改變一個 R 值，可以清楚看到這個 R 值的影響
- **對比分析**：可以比較 Rx、Ry、Rz 哪個影響更大

#### 2.2 所有 R 值同時掃描

**方法**：同時以相同比例改變所有 R 值

**例子**：
```
基準值：Rx = 0.1Ω, Ry = 0.1Ω, Rz = 0.5Ω

掃描範圍：所有 R 值從 0.5 倍到 2.0 倍
每步：Rx_new = 0.1 × ratio
      Ry_new = 0.1 × ratio
      Rz_new = 0.5 × ratio
```

**為什麼這樣做？**
- **整體影響**：了解如果所有 R 值都偏差，影響會如何
- **累加效應**：觀察多個 R 值同時變化的累加效應

### 步驟 3：計算指標

**目標**：從掃描結果中提取有用的指標

#### 3.1 總電阻（Total Resistance）

**計算方法**：
```cpp
double totalResistance = 0.0;
for (auto& branch : branches) {
    totalResistance += branch.resistance;
}
```

**意義**：
- 代表整個網路的總電阻
- 總電阻越大 → IR drop 越大（V = I × R）
- 如果 R 值不準確，總電阻也不準確

**為什麼用總和？**
- 這是簡化模型：實際 PDN 是並聯/串聯混合
- 但對於「觀察 R 值變化的影響」，這個簡化是合理的
- 總和模型：總電阻與 R 值成正比，容易分析

#### 3.2 敏感度（Sensitivity）

**計算公式**：
```
敏感度 = (總電阻變化) / (R 值變化)
       = ΔTotalR / ΔR
       = (TotalR_final - TotalR_initial) / (R_final - R_initial)
```

**代碼**：
```cpp
double resistanceChange = results.back().rx - results.front().rx;
double totalResChange = results.back().totalResistance - 
                       results.front().totalResistance;
double sensitivity = totalResChange / resistanceChange;
```

**例子**：
- Rx 從 0.05Ω → 0.20Ω（變化 0.15Ω）
- 總電阻從 0.9Ω → 1.8Ω（變化 0.9Ω）
- 敏感度 = 0.9 / 0.15 = 6.0

**解讀**：
- 敏感度 = 6.0 表示：Rx 每增加 0.01Ω，總電阻增加 0.06Ω
- **敏感度高**（> 10）→ R 值很重要，需要精確建模
- **敏感度中**（5-10）→ R 值有一定影響
- **敏感度低**（< 5）→ R 值影響較小，可以容忍誤差

### 步驟 4：結果分析

**目標**：從數據中得出結論

#### 4.1 比較不同 R 值

**問題**：Rx、Ry、Rz 哪個最重要？

**方法**：
1. 分別掃描 Rx、Ry、Rz
2. 計算各自的敏感度
3. 比較敏感度值

**例子**：
```
Rx 敏感度 = 6.0
Ry 敏感度 = 6.0
Rz 敏感度 = 2.0

結論：Rx 和 Ry 比 Rz 更重要
```

#### 4.2 評估 R 值重要性

**問題**：找到「好的 R 值」有多重要？

**方法**：
- 如果敏感度高 → 很重要
- 如果敏感度低 → 不太重要

**例子**：
```
如果敏感度 = 100：
  - Rx 誤差 10% → 總電阻誤差 10%
  - 這會導致 IR drop 分析不準確
  - 結論：找到準確的 R 值很重要！

如果敏感度 = 0.1：
  - Rx 誤差 10% → 總電阻誤差 1%
  - 影響很小
  - 結論：R 值可以有一定誤差
```

---

## 四、研究假設

### 假設 1：簡化電阻模型

**假設**：總電阻 = 所有分支電阻的總和

**實際情況**：
- 真實 PDN 是並聯/串聯混合的複雜網路
- 總電阻不是簡單的總和

**為什麼這樣假設？**
- **簡化分析**：總和模型容易計算和理解
- **趨勢分析**：雖然絕對值不準確，但「R 值變化的趨勢」是正確的
- **快速評估**：不需要完整的 SPICE 模擬

**影響**：
- 敏感度的絕對值可能不準確
- 但「哪個 R 值更重要」的結論是可靠的

### 假設 2：均勻 R 值

**假設**：所有 pixel model 使用相同的 R 值

**實際情況**：
- 不同位置的 R 值可能不同（例如：邊緣 vs 中心）

**為什麼這樣假設？**
- **分析 R 值的重要性**：我們想知道「R 值」這個參數的重要性
- **簡化模型**：如果每個位置都不同，分析會很複雜
- **基準比較**：均勻模型提供一個基準點

**影響**：
- 結果適用於「平均 R 值」的情況
- 對於非均勻 R 值，需要額外的分析

### 假設 3：線性關係

**假設**：R 值變化與總電阻變化是線性的

**實際情況**：
- 在簡化模型中（總和），這個假設成立
- 在複雜網路中可能不成立

**為什麼這樣假設？**
- **簡化模型**：總和模型本身就是線性的
- **易於分析**：線性關係容易理解和計算

**影響**：
- 在簡化模型中，這個假設是合理的
- 在複雜網路中，可能需要非線性分析

---

## 五、方法的優點和限制

### 優點

1. **簡單直接**：容易理解和實作
2. **快速分析**：不需要完整的 SPICE 模擬
3. **量化結果**：敏感度提供具體的數字
4. **系統性**：覆蓋整個參數空間
5. **可重複**：方法標準化，結果可重複

### 限制

1. **簡化模型**：總電阻 = 總和，不是實際的並聯/串聯
2. **沒有 IR drop**：只計算電阻，沒有實際的電壓降
3. **均勻假設**：所有位置使用相同的 R 值
4. **線性假設**：假設線性關係
5. **單變量分析**：一次只改變一個參數（除了「所有 R 值」的情況）

### 改進方向

1. **整合 SPICE**：加入實際的 IR drop 計算
2. **非均勻 R 值**：支援不同位置使用不同的 R 值
3. **多變量分析**：同時改變多個參數，觀察交互作用
4. **統計分析**：加入不確定性分析、置信區間
5. **非線性分析**：考慮非線性關係

---

## 六、研究流程總結

```
開始
  ↓
【步驟 1】建立基準 PDN 模型
  - 定義網格大小
  - 創建 PixelModel（基準 R 值）
  - 建立網路結構
  ↓
【步驟 2】執行參數掃描
  - 掃描 Rx（固定 Ry, Rz）
  - 掃描 Ry（固定 Rx, Rz）
  - 掃描 Rz（固定 Rx, Ry）
  - 掃描所有 R 值
  ↓
【步驟 3】計算指標
  - 對每個掃描點計算總電阻
  - 計算敏感度（ΔTotalR / ΔR）
  ↓
【步驟 4】結果分析
  - 比較不同 R 值的敏感度
  - 評估 R 值的重要性
  - 得出結論
  ↓
【步驟 5】輸出結果
  - CSV 檔案（詳細數據）
  - 摘要報告（敏感度值）
  ↓
結束
```

---

## 七、預期結果和應用

### 預期結果

1. **敏感度值**：每個 R 值的敏感度
2. **比較結果**：Rx、Ry、Rz 哪個最重要
3. **重要性評估**：R 值對結果的影響程度

### 應用場景

1. **設計優化**：
   - 如果敏感度高 → 投入更多資源做精確的 R 值建模
   - 如果敏感度低 → 可以使用簡化的 R 值模型

2. **驗證重要性**：
   - 證明「找到好的 R 值」確實很重要
   - 量化重要性程度

3. **風險評估**：
   - 了解 R 值誤差帶來的風險
   - 設定 R 值建模的精度要求

---

## 八、總結

### 這個研究做了什麼？

1. **建立模型**：用 PixelModel 和 PDNNetwork 表示 PDN
2. **執行分析**：系統性地改變 R 值，觀察結果變化
3. **量化影響**：計算敏感度，量化 R 值對結果的影響
4. **得出結論**：判斷 R 值的重要性

### 研究目標

**問題**：「R 值對結果的影響有多大？」

**答案**：通過敏感度分析，我們可以：
- 量化影響程度（敏感度值）
- 比較不同 R 值的重要性
- 判斷是否需要精確的 R 值建模

**結論**：如果敏感度高 → 找到「好的 R 值」確實很重要！

