# 敏感度分析詳細說明

## 什麼是敏感度分析？

敏感度分析（Sensitivity Analysis）是一種研究方法，用來了解**輸入參數的變化對輸出結果的影響程度**。

在我們的 PDN 建模中：
- **輸入參數**：Pixel Model 的 R 值（Rx, Ry, Rz）
- **輸出結果**：PDN 網路的總電阻、路徑電阻等
- **目標**：了解 R 值的變化會如何影響整個網路的電阻特性

## 為什麼要做這個分析？

### 核心問題
在設計 PDN 時，我們需要知道：
1. **R 值的重要性**：如果 R 值不準確，對結果影響有多大？
2. **哪個 R 值最關鍵**：Rx、Ry、還是 Rz 對結果影響最大？
3. **容錯範圍**：R 值可以偏差多少，結果還能接受？

### 實際應用
- **設計優化**：知道哪些 R 值需要更精確的建模
- **驗證重要性**：證明找到「好的 R 值」確實很重要
- **風險評估**：了解 R 值不準確帶來的風險

## 分析方法詳解

### 方法 1：單一 R 值掃描（Sweep Single Resistance）

#### 概念
固定其他 R 值，只改變一個 R 值（例如只改變 Rx），觀察網路總電阻的變化。

#### 步驟
```
1. 設定基礎值：
   - baseRx = 0.1 Ω
   - baseRy = 0.1 Ω  
   - baseRz = 0.5 Ω

2. 掃描範圍：
   - 從 0.5x 到 2.0x（即從 0.5 倍到 2 倍）
   - 分成 20 個步驟

3. 對每個步驟：
   - 計算新的 R 值：Rx_new = baseRx × ratio
   - 將所有 pixel model 的 Rx 設為新值
   - 重建 PDN 網路
   - 計算網路總電阻
   - 記錄結果

4. 分析結果：
   - 計算敏感度：ΔTotalR / ΔRx
   - 觀察總電阻的變化範圍
```

#### 視覺化例子
```
Rx 變化 → 網路總電阻變化

Rx = 0.05 Ω (0.5x) → TotalR = 5.0 Ω
Rx = 0.10 Ω (1.0x) → TotalR = 10.0 Ω  ← 基準值
Rx = 0.15 Ω (1.5x) → TotalR = 15.0 Ω
Rx = 0.20 Ω (2.0x) → TotalR = 20.0 Ω

敏感度 = (20.0 - 5.0) / (0.20 - 0.05) = 15.0 / 0.15 = 100
這表示：Rx 每增加 0.01 Ω，總電阻增加 1.0 Ω
```

### 方法 2：所有 R 值同時掃描（Sweep All Resistances）

#### 概念
同時以相同比例改變所有 R 值（Rx, Ry, Rz），觀察網路總電阻的變化。

#### 步驟
```
1. 設定基礎值和掃描範圍（同上）

2. 對每個步驟：
   - 計算新的 R 值：
     Rx_new = baseRx × ratio
     Ry_new = baseRy × ratio
     Rz_new = baseRz × ratio
   - 將所有 pixel model 的 R 值設為新值
   - 重建 PDN 網路
   - 計算網路總電阻
   - 記錄結果
```

#### 用途
- 了解整體 R 值縮放對網路的影響
- 評估如果所有 R 值都偏差相同比例，結果會如何

## 計算的指標

### 1. 總電阻（Total Resistance）
```
TotalR = Σ(所有分支的電阻)
```
- **意義**：整個網路的總電阻
- **用途**：了解 R 值變化對整體網路的影響

### 2. 平均分支電阻（Average Branch Resistance）
```
AvgBranchR = TotalR / 分支數量
```
- **意義**：平均每個分支的電阻
- **用途**：了解 R 值變化對個別分支的影響

### 3. 最大/最小分支電阻（Max/Min Branch Resistance）
- **意義**：網路中電阻最大和最小的分支
- **用途**：識別網路中的瓶頸（高電阻分支）

### 4. 路徑電阻（Path Resistance）
```
PathR = 平均分支電阻 × 路徑長度
```
- **意義**：從一個點到另一個點的總電阻
- **用途**：評估特定路徑的電阻特性

### 5. 敏感度（Sensitivity）
```
Sensitivity = ΔTotalR / ΔR
```
- **意義**：R 值變化 1 單位時，總電阻變化多少
- **用途**：量化 R 值對結果的影響程度
  - **值越大**：表示該 R 值對結果影響越大
  - **值越小**：表示該 R 值對結果影響較小

## 實際例子

### 假設場景
- **網路大小**：10×10 網格
- **基礎 R 值**：Rx = 0.1 Ω, Ry = 0.1 Ω, Rz = 0.5 Ω
- **掃描範圍**：0.5x 到 2.0x（20 步）

### 結果解讀

#### 情況 A：Rx 敏感度高
```
Rx 從 0.05 Ω → 0.20 Ω
TotalR 從 5.0 Ω → 25.0 Ω
敏感度 = 20.0 / 0.15 = 133.3

結論：Rx 對結果影響很大，需要精確建模
```

#### 情況 B：Ry 敏感度低
```
Ry 從 0.05 Ω → 0.20 Ω
TotalR 從 10.0 Ω → 12.0 Ω
敏感度 = 2.0 / 0.15 = 13.3

結論：Ry 對結果影響較小，可以容忍較大誤差
```

#### 情況 C：Rz 敏感度中等
```
Rz 從 0.25 Ω → 1.0 Ω
TotalR 從 10.0 Ω → 18.0 Ω
敏感度 = 8.0 / 0.75 = 10.7

結論：Rz 有一定影響，但不如 Rx 關鍵
```

## 如何解讀 CSV 結果

### CSV 檔案格式
```csv
Rx,Ry,Rz,TotalResistance,AvgBranchResistance,MaxBranchResistance,MinBranchResistance,PathResistance
0.05,0.10,0.50,5.0,0.05,0.05,0.05,0.90
0.10,0.10,0.50,10.0,0.10,0.10,0.10,1.80
0.15,0.10,0.50,15.0,0.15,0.15,0.15,2.70
...
```

### 分析步驟

1. **繪製圖表**：
   - X 軸：R 值（Rx, Ry, 或 Rz）
   - Y 軸：TotalResistance
   - 觀察趨勢：線性？非線性？

2. **計算敏感度**：
   ```
   敏感度 = (最後的 TotalR - 第一個 TotalR) / (最後的 R - 第一個 R)
   ```

3. **比較不同 R 值**：
   - 哪個 R 值的敏感度最高？
   - 哪個 R 值對結果影響最大？

4. **評估重要性**：
   - 如果敏感度高 → 需要精確的 R 值
   - 如果敏感度低 → R 值可以有一定誤差

## 實際應用建議

### 1. 設計階段
- 先做敏感度分析，了解哪些 R 值最關鍵
- 對高敏感度的 R 值，投入更多資源做精確建模

### 2. 驗證階段
- 用敏感度分析證明 R 值的重要性
- 如果敏感度高，說明找到「好的 R 值」確實很重要

### 3. 優化階段
- 根據敏感度結果，優先優化高敏感度的 R 值
- 對低敏感度的 R 值，可以使用簡化模型

## 方法限制與改進

### 當前方法的限制
1. **簡化模型**：只計算總電阻，沒有實際的 IR drop 計算
2. **均勻假設**：假設所有 pixel model 使用相同的 R 值
3. **線性假設**：假設 R 值變化與結果變化是線性的

### 可能的改進
1. **整合 SPICE 模擬**：加入實際的 IR drop 計算
2. **非均勻 R 值**：支援不同位置使用不同的 R 值
3. **多變量分析**：同時改變多個 R 值，觀察交互作用
4. **統計分析**：加入置信區間、不確定性分析等

## 總結

敏感度分析的核心思想是：
1. **系統性地改變輸入參數**（R 值）
2. **觀察輸出結果的變化**（網路總電阻）
3. **量化影響程度**（敏感度）
4. **得出結論**（哪些 R 值最重要）

這樣可以幫助你：
- 了解 R 值對結果的影響
- 證明找到「好的 R 值」的重要性
- 優化建模和設計流程

